$schema: "http://json-schema.org/draft-07/schema#"
$id: ROSCO_toolbox_schema
title: ROSCO toolbox schema
description: Definition of inputs for ROSCO tuning procedure
type: object
properties:
    path_params:
        type: object
        default: {}
        required:
            - FAST_InputFile
            - FAST_directory
            - rotor_performance_filename
        properties:
            FAST_InputFile:
                type: string
                description: Name of `*.fst` file
                # default: IEA-15-240-RWT-UMaineSemi.fst
            FAST_directory:
                type: string
                description: Main OpenFAST model directory, where the `*.fst` lives, relative to ROSCO dir (if applicable)
                # default: Test_Cases/IEA-15-240-RWT-UMaineSemi
            rotor_performance_filename:
                type: string
                description: Filename for rotor performance text file (if it has been generated by ccblade already)
                # default: Cp_Ct_Cq.IEA15MW.txt

    turbine_params:
        type: object
        default: {}
        required:
            - rotor_inertia
            - rated_rotor_speed
            - v_rated
            - max_pitch_rate
            - max_torque_rate
            - rated_power
            - bld_edgewise_freq
            - bld_flapwise_freq
        properties:
            rotor_inertia:
                type: number
                description: Rotor inertia [kg m^2], {Available in Elastodyn .sum file}
                unit: kg m^2
            rated_rotor_speed:
                type: number
                description: Rated rotor speed [rad/s]
                unit: rad/s
                minimum: 0
            v_min:
                type: number
                description: Cut-in wind speed of the wind turbine.
                unit: m/s
                minimum: 0
            v_max:
                type: number
                description: Cut-out wind speed of the wind turbine.
                unit: m/s
                minimum: 0
            max_pitch_rate:
                type: number
                description: Maximum blade pitch rate [rad/s]
                unit: rad/s
                minimum: 0
            max_torque_rate:
                type: number
                description: Maximum torque rate [Nm/s], {~1/4 VS_RtTq/s}
                unit: Nm/s
                minimum: 0
            rated_power:
                type: number
                description: Rated Power [W]
                unit: W
                minimum: 0
            bld_edgewise_freq:
                type: number
                description: Blade edgewise first natural frequency [rad/s]
                unit: rad/s
                minimum: 0
                default: 4.0
            bld_flapwise_freq:
                type: number
                description: Blade flapwise first natural frequency [rad/s]
                unit: rad/s
                minimum: 0
                default: 0
            TSR_operational:
                type: number
                description: Optimal tip speed ratio, if 0 the optimal TSR will be determined by the Cp surface
                unit: none
                default: 0
                minimum: 0

            
    controller_params:
        type: object
        properties:
            LoggingLevel:
                type: number
                description: 0- write no debug files, 1- write standard output .dbg-file, 2- write standard output .dbg-file and complete avrSWAP-array .dbg2-file
                minimum: 0
                maximum: 2
                default: 1
            F_LPFType:
                type: number
                description: 1- first-order low-pass filter, 2- second-order low-pass filter, [rad/s] (currently filters generator speed and pitch control signals)
                minimum: 1
                maximum: 2
                default: 1
            F_NotchType:        
                type: number
                minimum: 0
                maximum: 3
                default: 0
                description: Notch on the measured generator speed and/or tower fore-aft motion (for floating) {0- disable, 1- generator speed, 2- tower-top fore-aft motion, 3- generator speed and tower-top fore-aft motion}
            IPC_ControlMode:    
                type: number
                minimum: 0
                maximum: 2
                default: 0
                description: Turn Individual Pitch Control (IPC) for fatigue load reductions (pitch contribution) (0- off, 1- 1P reductions, 2- 1P+2P reduction)
            VS_ControlMode:     
                type: number
                minimum: 0
                maximum: 3
                default: 2
                description: Generator torque control mode in above rated conditions (0- constant torque, 1- constant power, 2- TSR tracking PI control with constant torque, 3- TSR tracking with constant power)
            PC_ControlMode:     
                type: number
                minimum: 0
                maximum: 1
                default: 1
                description: Blade pitch control mode (0- No pitch, fix to fine pitch, 1- active PI blade pitch control)
            Y_ControlMode:      
                type: number
                minimum: 0
                maximum: 2
                default: 0
                description: Yaw control mode (0- no yaw control, 1- yaw rate control, 2- yaw-by-IPC)
            SS_Mode:            
                type: number
                minimum: 0
                maximum: 2
                default: 1
                description: Setpoint Smoother mode (0- no setpoint smoothing, 1- introduce setpoint smoothing)
            WE_Mode:            
                type: number
                minimum: 0
                maximum: 2
                default: 2
                description: Wind speed estimator mode (0- One-second low pass filtered hub height wind speed, 1- Immersion and Invariance Estimator (Ortega et al.)
            PS_Mode:            
                type: number
                minimum: 0
                maximum: 3
                default: 3
                description: Pitch saturation mode (0- no pitch saturation, 1- peak shaving, 2- Cp-maximizing pitch saturation, 3- peak shaving and Cp-maximizing pitch saturation)
            SD_Mode:            
                type: number
                minimum: 0
                maximum: 1
                default: 0
                description: Shutdown mode (0- no shutdown procedure, 1- pitch to max pitch at shutdown)
            Fl_Mode:            
                type: number
                minimum: 0
                maximum: 2
                default: 0
                description: Floating specific feedback mode (0- no nacelle velocity feedback, 1 - nacelle velocity feedback, 2 - nacelle pitching acceleration feedback)
            Flp_Mode:           
                type: number
                minimum: 0
                maximum: 2
                default: 0
                description: Flap control mode (0- no flap control, 1- steady state flap angle, 2- Proportional flap control)
            PwC_Mode:           
                type: number
                minimum: 0
                maximum: 2
                default: 0
                description: Active Power Control Mode (0- no active power control 1- constant active power control, 2- open loop power vs time, 3- open loop power vs. wind speed)
            U_pc:                       
                type: array
                description: List of wind speeds to schedule pitch control zeta and omega 
                unit: m/s
                items:
                    type: number
                    minimum: 0
                    uniqueItems: True
                default: [12]
            zeta_pc:                       
                type: [array,number]
                description: List of pitch controller desired damping ratio at U_pc [-]
                unit: none
                items:
                    type: number
                    minimum: 0
                default: [1.0]
            omega_pc:                     
                type: [array,number]
                description: List of pitch controller desired natural frequency at U_pc [rad/s]
                unit: rad/s
                items:
                    type: number
                    minimum: 0
                default: [0.2]
            interp_type:
                type: string
                description: Type of interpolation between above rated tuning values (only used for multiple pitch controller tuning values)
                default: sigma
                enum: ['sigma', 'linear', 'quadratic', 'cubic']
            zeta_vs:                        
                type: number
                minimum: 0
                description: Torque controller desired damping ratio [-]
                unit: none
                default: 1.0
            omega_vs:                     
                type: number
                minimum: 0
                description: Torque controller desired natural frequency [rad/s]
                unit: rad/s
                default: 0.2
            max_pitch:           
                description: Maximum pitch angle [rad], {default = 90 degrees}
                type: number
                default: 1.57
                unit: rad
            min_pitch:           
                description: Minimum pitch angle [rad], {default = 0 degrees}
                type: number
                default: 0
                unit: rad
            vs_minspd:           
                description: Minimum rotor speed [rad/s], {default = 0 rad/s}
                type: number
                default: 0
                unit: rad/s
            ss_vsgain:           
                description: Torque controller setpoint smoother gain bias percentage [%, <= 1 ], {default = 100%}
                type: number
                default: 1.000
                unit: None
            ss_pcgain:           
                description: Pitch controller setpoint smoother gain bias percentage  [%, <= 1 ], {default = 0.1%}
                type: number
                default: 0.001
                unit: rad
            ps_percent:          
                description: Percent peak shaving  [%, <= 1 ], {default = 80%}
                type: number
                default: 0.8
                maximum: 1
                unit: rad
            sd_maxpit:           
                description: Maximum blade pitch angle to initiate shutdown [rad], {default = 40 deg.}
                type: number
                default: 0.6981
                unit: rad
            flp_maxpit:            
                description: Maximum (and minimum) flap pitch angle [rad]
                type: number
                default: 0.1745
                unit: rad
            twr_freq:
                type: number
                description: Tower natural frequency, for floating only
                unit: rad/s
                minimum: 0
            ptfm_freq:
                type: number
                description: Platform natural frequency, for floating only
                unit: rad/s
                minimum: 0
            WS_GS_n:
                type: number
                description: Number of wind speed breakpoints
                minimum: 0
                default: 60
            PC_GS_n:
                type: number
                description: Number of pitch angle gain scheduling breakpoints
                minimum: 0
                default: 30
            Kp_float:
                type: number
                description: Gain of floating feedback control
                unit: s
            tune_Fl:
                type: boolean
                description: Whether to automatically tune Kp_float
                default: True
            zeta_flp:                        
                type: number
                minimum: 0
                description: Flap controller desired damping ratio [-]
                unit: none
            omega_flp:                     
                type: number
                minimum: 0
                description: Flap controller desired natural frequency [rad/s]
                unit: rad/s
            flp_kp_norm:                     
                type: number
                minimum: 0
                description: Flap controller normalization term for DC gain (kappa) 
            flp_tau:                     
                type: number
                minimum: 0
                description: Flap controller time constant for integral gain
                unit: s
            IPC_Kp1p:                     
                type: number
                minimum: 0
                description: Proportional gain for IPC, 1P [s]
                default: 0.0
                unit: s
            IPC_Kp2p:                     
                type: number
                minimum: 0
                description: Proportional gain for IPC, 2P [-]
                default: 0.0
            IPC_Ki1p:                     
                type: number
                minimum: 0
                description: Integral gain for IPC, 1P [s]
                default: 0.0
                unit: s
            IPC_Ki2p:                     
                type: number
                minimum: 0
                description: integral gain for IPC, 2P [-]
                default: 0.0
            filter_params:
                type: object
                default: {}
                properties:
                    f_lpf_cornerfreq:
                        type: number
                        description: Corner frequency (-3dB point) in the first order low pass filter of the generator speed [rad/s]
                        minimum: 0
                        unit: rad/s
                        # default: 1.00810
                    f_lpf_damping:
                        type: number
                        description: Damping ratio in the first order low pass filter of the generator speed [-]
                        minimum: 0
                        unit: rad/s
                        # default: 0.707
                    f_we_cornerfreq:
                        type: number
                        description: Corner frequency (-3dB point) in the first order low pass filter for the wind speed estimate [rad/s]
                        minimum: 0
                        unit: rad/s
                        default: 0.209440
                    f_fl_highpassfreq:        
                        type: number
                        minimum: 0
                        unit: rad/s
                        default: 0.01042
                        description: Natural frequency of first-order high-pass filter for nacelle fore-aft motion [rad/s]
                    f_ss_cornerfreq:
                        type: number
                        description: First order low-pass filter cornering frequency for setpoint smoother [rad/s]
                        minimum: 0
                        unit: rad/s
                        default: 0.6283
                    f_sd_cornerfreq:       
                        description: Cutoff Frequency for first order low-pass filter for blade pitch angle [rad/s], {default = 0.41888 ~ time constant of 15s}
                        type: number
                        default: 0.41888
                        unit: rad
            open_loop:
                type: object
                default: {}
                properties:
                    flag:
                        description: Flag to use open loop control
                        type: boolean
                        default: False
                    filename:
                        description: Filename of open loop input that ROSCO reads
                        type: string
                        default: unused
                    OL_Ind_Breakpoint:
                        description: Index (column, 1-indexed) of breakpoint (time) in open loop index
                        type: number
                        default: 1
                    OL_Ind_BldPitch:
                        description: Index (column, 1-indexed) of breakpoint (time) in open loop index
                        type: number
                        default: 0
                    OL_Ind_GenTq:
                        description: Index (column, 1-indexed) of breakpoint (time) in open loop index
                        type: number
                        default: 0
                    OL_Ind_YawRate:
                        description: Index (column, 1-indexed) of breakpoint (time) in open loop index
                        type: number
                        default: 0



    linmodel_tuning:
        type: object
        default: {}
        description: Inputs used for tuning ROSCO using linear (level 2) models
        properties:
            type: 
                type: string
                description: Type of level 2 based tuning - robust gain scheduling (robust) or simulation based optimization (simulation)
                default: 'none' 
                enum: ['none', 'robust', 'simulation']
            linfile_path:
                type: string
                description: Path to OpenFAST linearization (.lin) files, if they exist 
                default: none
            lintune_outpath:
                type: string
                description: Path for outputs from linear model based tuning
                default: lintune_outfiles
            load_parallel:
                type: boolean
                description: Load linearization files in parallel (True/False)
                default: False
            stability_margin:
                type: [number, array]
                description: Desired maximum stability margin
                default: 0.1
                items:
                    type: number
            omega_pc:
                type: object
                default: {}
                description: Pitch controller bandwidth constraints
                min:
                    type: [number, array]
                    default: 0.0
                    description: Desired maximum allowable omega for robust tuning. Array must be of length U_pc.
                    items:
                        type: number
                max:
                    type: [number, array]
                    default: 0.2
                    description: Desired maximum allowable omega for robust tuning. Array must be of length U_pc.
                    items:
                        type: number
       
